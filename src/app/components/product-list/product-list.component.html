<mat-toolbar>
    <button mat-icon-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
    </button>
    <span>{{title}} </span>
    <button (click)="submit()" class="save-btn" [disabled]="form.invalid " mat-flat-button color="primary"> Сохранить
    </button>

</mat-toolbar>
<div class="container">
    <div class="date mat-h2">
        {{_sale.date | date:"EE, d MMM yyyy"}}
    </div>

    <form class="form" [formGroup]='form' [appConnectFormGroup]="_sale">
        <!-- Discount -->
        <mat-card class="form__discount">
            <mat-form-field class="form__discount-field" color="primary">
                <input formControlName="discount" autocomplete="off" type="number" matInput placeholder="Скидка">
                <button type="button" mat-icon-button matSuffix (click)="clearValue()">
                    <mat-icon>close</mat-icon>
                </button>
            </mat-form-field>
            <app-easy-enter (change)="setValue($event)"> </app-easy-enter>
        </mat-card>

        <!--  -->
        <mat-accordion formArrayName="productList" [hideToggle]='true'>
            <!-- Product List -->
            <mat-expansion-panel *ngFor="let product of arrayProduct.controls; index as i" [formGroupName]="i">
                <mat-expansion-panel-header>
                    <mat-panel-title> {{product.get("name").value}} </mat-panel-title>
                    <mat-panel-description>
                        <div class="panel-description">
                            <span>{{product.get("count").value}}шт.</span>
                            <span>
                                {{product.get("price").value * product.get("count").value | currency:'RUB':'symbol-narrow'}}
                            </span>
                        </div>
                    </mat-panel-description>
                    <!-- <mat-panel-description *ngIf='lastItem'> Добавить новый товар </mat-panel-description> -->
                </mat-expansion-panel-header>

                <div class="form__product-field">

                    <mat-form-field color="primary">
                        <input formControlName="name" autocomplete="off" type="text" matInput placeholder="Товар">
                    </mat-form-field>
                    <mat-form-field color="primary">
                        <input formControlName="count" autocomplete="off" type="number" matInput
                            placeholder="Количество">
                    </mat-form-field>
                    <mat-form-field color="primary">
                        <input formControlName="price" autocomplete="off" type="number" matInput placeholder="Цена">
                    </mat-form-field>
                </div>
                <mat-action-row>
                    <mat-icon>delete</mat-icon>
                    <span> Удалить </span>
                </mat-action-row>
            </mat-expansion-panel>
            <!--  -->
        </mat-accordion>
    </form>

    <!-- <pre>
            {{sale$  | async | json}}
        </pre> -->
</div>