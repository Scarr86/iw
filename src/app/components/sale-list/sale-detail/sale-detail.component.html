<mat-toolbar>
  <button mat-icon-button (click)="goBack()">
    <mat-icon>arrow_back</mat-icon>
  </button>
  <span>{{ title }} </span>
  <button
    (click)="submit()"
    class="save-btn"
    [disabled]="form.invalid"
    mat-flat-button
    color="primary"
  >
    Сохранить
  </button>
</mat-toolbar>

<div class="container">
  <div class="date mat-h2">
    <!-- {{_sale.date | date:"EE, d MMM yyyy"}} -->
  </div>

  <form
    class="form"
    [formGroup]="form"
    [appConnectFormGroup]="sale$ | async"
    (ngSubmit)="save()"
    #formRef="ngForm"
  >
    <!-- Discount -->
    <mat-card class="form__discount">
      <mat-form-field class="form__discount-field">
        <input
          #discount
          formControlName="discount"
          autocomplete="off"
          type="number"
          matInput
          placeholder="Скидка"
        />
        <button
          type="button"
          mat-icon-button
          matSuffix
          (click)="discount.value = ''"
        >
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
      <!-- <app-easy-enter (change)="discount.value = +discount.value + $event"> </app-easy-enter> -->
    </mat-card>

    <!--  -->
    <mat-accordion formArrayName="productList" [hideToggle]="true">
      <!-- Product List -->
      <mat-expansion-panel
        *ngFor="let product of arrayProduct.controls; index as i"
        [formGroupName]="i"
      >
        <mat-expansion-panel-header>
          <mat-panel-title> {{ product.get("name").value }} </mat-panel-title>
          <mat-panel-description>
            <div class="panel-description">
              <span>{{ product.get("count").value }}шт.</span>
              <span>
                {{
                  product.get("price").value * product.get("count").value
                    | currency: "RUB":"symbol-narrow"
                }}
              </span>
            </div>
          </mat-panel-description>
          <!-- <mat-panel-description *ngIf='lastItem'> Добавить новый товар </mat-panel-description> -->
        </mat-expansion-panel-header>

        <app-easy-enter
          [source]="arrayProduct.controls[i].controls['name']"
          type="text"
          placeholder="Название"
        >
        </app-easy-enter>
        <app-easy-enter
          [source]="arrayProduct.controls[i].controls['count']"
          type="count"
          placeholder="Количество"
        >
        </app-easy-enter>
        <app-easy-enter
          [source]="arrayProduct.controls[i].controls['price']"
          type="number"
          placeholder="Цена"
        >
        </app-easy-enter>
        <mat-action-row>
          <mat-icon>delete</mat-icon>
          <span> Удалить </span>
        </mat-action-row>
      </mat-expansion-panel>
      <!--  -->
    </mat-accordion>
  </form>
</div>
